{{!
    This file is part of Moodle - http://moodle.org/

    Moodle is free software: you can redistribute it and/or modify
    it under the terms of the GNU General Public License as published by
    the Free Software Foundation, either version 3 of the License, or
    (at your option) any later version.

    Moodle is distributed in the hope that it will be useful,
    but WITHOUT ANY WARRANTY; without even the implied warranty of
    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
    GNU General Public License for more details.

    You should have received a copy of the GNU General Public License
    along with Moodle.  If not, see <http://www.gnu.org/licenses/>.
}}
{{!
    @template block_empfohlene_kurse/main

    Haupttemplate f√ºr den Block "Empfohlene Kurse"

    Classes required for JS:
    * slider-container
    * main-course
    * course-cards
    * slider-nav
}}
<div class="block_empfohlene_kurse" id="block_empfohlene_kurse_{{uniqid}}" data-image-fit="{{image_fit}}" data-image-height="{{image_height}}" data-border-radius="{{border_radius}}" data-animation-speed="{{animation_speed}}">
    {{#hascourses}}
        <div class="slider-container">
            {{#courses}}
                {{#first}}
                    <div class="main-course-wrapper" data-course-id="{{id}}">
                        <div class="main-course" style="border-radius: {{border_radius}}px;">
                            <div class="main-course-image image-fit-{{image_fit}}" style="height: {{image_height}}px;">
                                <img src="{{courseimage}}" alt="{{fullname}}" style="object-fit: {{image_fit}};">
                            </div>
                            <div class="main-course-content">
                                <div class="main-course-title">{{fullname}}</div>
                                <div class="main-course-description">{{summary}}</div>
                                <div class="button-container">
                                    <a href="{{enrollurl}}" class="btn btn-primary">{{buttontext}}</a>
                                </div>
                            </div>
                        </div>
                    </div>
                {{/first}}
            {{/courses}}
            
            <div class="course-cards">
                {{#courses}}
                    {{^first}}
                        {{#visible}}
                            <div class="course-card" data-course-id="{{id}}">
                                <div class="course-card-image">
                                    <img src="{{courseimage}}" alt="{{fullname}}">
                                </div>
                                <div class="course-card-title">{{fullname}}</div>
                            </div>
                        {{/visible}}
                    {{/first}}
                {{/courses}}
            </div>
            
            <div class="slider-nav prev" title="{{prev_course}}" style="top: calc({{image_height}}px / 2); margin-top: -20px;">
                <i class="fa fa-chevron-left"></i>
            </div>
            <div class="slider-nav next" title="{{next_course}}" style="top: calc({{image_height}}px / 2); margin-top: -20px;">
                <i class="fa fa-chevron-right"></i>
            </div>
        </div>
    {{/hascourses}}
    
    {{^hascourses}}
        <div class="no-courses">
            {{no_courses_message}}
        </div>
    {{/hascourses}}
</div>

{{#js}}
require(['jquery'], function($) {
    var container = $('#block_empfohlene_kurse_{{uniqid}}');
    var allCourses = {{{coursesJson}}};
    
    if (!allCourses || allCourses.length === 0) {
        return;
    }
    
    var coursesCount = allCourses.length;
    var currentIndex = 0;
    var visibleCards = 3;
    
    // Konfigurationsoptionen aus data-Attributen
    var imageFit = container.attr('data-image-fit') || 'cover';
    var imageHeight = container.attr('data-image-height') || '200';
    var borderRadius = container.attr('data-border-radius') || '8';
    var animationSpeed = parseInt(container.attr('data-animation-speed')) || 300;
    
    function updateSlider() {
        if (coursesCount === 0) return;
        
        var mainCourse = allCourses[currentIndex];
        var $mainCourseWrapper = container.find('.main-course-wrapper');
        
        // Mit Animation aktualisieren (falls aktiviert)
        if (animationSpeed > 0) {
            $mainCourseWrapper.css('opacity', '0');
            setTimeout(function() {
                updateContent();
                $mainCourseWrapper.animate({opacity: 1}, animationSpeed);
            }, animationSpeed / 2);
        } else {
            updateContent();
        }
        
        function updateContent() {
            $mainCourseWrapper.attr('data-course-id', mainCourse.id);
            
            // Bildeinstellungen dynamisch anwenden
            var $image = $mainCourseWrapper.find('.main-course-image img');
            $image.attr('src', mainCourse.courseimage)
                  .attr('alt', mainCourse.fullname)
                  .css('object-fit', imageFit);
            
            $mainCourseWrapper.find('.main-course-image')
                  .css('height', imageHeight + 'px')
                  .removeClass('image-fit-cover image-fit-contain image-fit-fill')
                  .addClass('image-fit-' + imageFit);
            
            $mainCourseWrapper.find('.main-course')
                  .css('border-radius', borderRadius + 'px');
            
            $mainCourseWrapper.find('.main-course-title').text(mainCourse.fullname);
            $mainCourseWrapper.find('.main-course-description').text(mainCourse.summary);
            $mainCourseWrapper.find('.button-container a').attr('href', mainCourse.enrollurl);
        }
        
        var $courseCards = container.find('.course-cards');
        $courseCards.empty();
        
        var cardsToShow = Math.min(visibleCards, coursesCount - 1);
        
        for (var i = 1; i <= cardsToShow; i++) {
            var index = (currentIndex + i) % coursesCount;
            var course = allCourses[index];
            
            var $card = $('<div>').addClass('course-card').attr('data-course-id', course.id);
            var $imageContainer = $('<div>').addClass('course-card-image');
            var $image = $('<img>').attr('src', course.courseimage).attr('alt', course.fullname);
            var $title = $('<div>').addClass('course-card-title').text(course.fullname);
            
            $imageContainer.append($image);
            $card.append($imageContainer).append($title);
            $courseCards.append($card);
        }
    }
    
    container.on('click', '.course-card', function(e) {
        e.preventDefault();
        var courseId = $(this).attr('data-course-id');
        
        for (var i = 0; i < allCourses.length; i++) {
            if (allCourses[i].id == courseId) {
                currentIndex = i;
                updateSlider();
                break;
            }
        }
    });
    
    container.on('click', '.slider-nav.prev', function(e) {
        e.preventDefault();
        currentIndex = (currentIndex - 1 + coursesCount) % coursesCount;
        updateSlider();
    });
    
    container.on('click', '.slider-nav.next', function(e) {
        e.preventDefault();
        currentIndex = (currentIndex + 1) % coursesCount;
        updateSlider();
    });
    
    if (coursesCount > 1) {
        updateSlider();
    } else {
        container.find('.slider-nav').hide();
    }
});
{{/js}}
